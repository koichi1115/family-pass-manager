# 家族用ID・パスワード管理サイト 要件定義書

## 1. 目的

家族内で安全かつ効率的にID・パスワード情報を共有・管理するためのウェブサイトを構築する。特に、クライアント証明書によるアクセス制限と、銀行口座情報のような複数項目にわたるパスワード情報の管理、変更履歴の追跡、および家族メンバーごとの絞り込み機能を実装する。

## 2. 対象利用者

- **主利用者**: 父、母、息子、娘など、事前に認証された家族メンバー
- **想定利用デバイス**: iPhone（クライアント証明書インストール対象）、その他スマートフォン、PC

## 3. システム構成

### 3.1 推奨技術スタック

- **フロントエンド**:
  - **技術**: React + TypeScript（型安全性とメンテナンス性を重視）
  - **UI フレームワーク**: Material-UI または Chakra UI
  - **状態管理**: Zustand または Context API
  - **ホスティング**: Vercel（GitHub連携とCI/CD）
- **バックエンド**:
  - **技術**: Vercel Serverless Functions
  - **データベース**: PlanetScale（MySQL互換）またはSupabase（PostgreSQL）
  - **認証**: NextAuth.js + カスタムクライアント証明書検証
- **その他**:
  - **暗号化**: CryptoJS（クライアントサイド暗号化）
  - **ソースコード管理**: GitHub
  - **SSL証明書**: Let's Encrypt（自動更新）

### 3.2 アーキテクチャ概要

```
[iPhone (Client Cert)] ←→ [Vercel (Frontend + API)] ←→ [Database]
                                    ↓
                            [GitHub (CI/CD)]
```

## 4. 機能要件

### 4.1 認証・認可

#### F-Auth-01: クライアント証明書認証
- 特定のiPhoneにインストールされたクライアント証明書のみがウェブサイトへのアクセスを許可される
- サーバーサイドでクライアント証明書の有効性を検証する
- 証明書が無効な場合はアクセスを拒否し、適切なエラーメッセージを表示する
- **証明書管理**: 家族メンバーごとに個別の証明書を発行・管理する

#### F-Auth-02: 家族メンバー識別
- クライアント証明書認証後、各家族メンバーを識別するためのユーザー選択画面を提供する
- 選択された家族メンバーの識別子をセッション情報として保持する
- **自動ログアウト**: 一定時間操作がない場合の自動ログアウト機能

### 4.2 パスワード情報管理

#### F-Data-01: データ構造
各パスワードエントリは以下の項目を管理する：

**必須項目**:
- サービス名（例: みずほ銀行、Amazon）
- メインID/ユーザー名
- メインパスワード
- 登録者（家族メンバー名）
- 登録日時、最終更新日時

**任意項目**:
- 取引パスワード/PINコード（複数設定可能、用途別）
- 秘密の質問と答え（複数設定可能）
- その他メモ（自由記述）
- カテゴリ（銀行、ECサイト、SNS、公共料金など、複数選択可能）
- 重要度（高・中・低）
- 有効期限（パスワード変更予定日）

#### F-Data-02: 暗号化・セキュリティ
- すべての機密情報はクライアントサイドで暗号化してから送信・保存する
- 暗号化にはAES-256を使用し、家族共通のマスターパスワードで暗号化/復号する
- マスターパスワードはサーバーに保存せず、必要時にユーザー入力で取得する

### 4.3 CRUD操作

#### F-CRUD-01: 情報の追加
- 認証されたユーザーは新たなパスワード情報を追加できる
- 必須項目の入力チェックとバリデーションを実装する
- 複数項目（取引パスワード、秘密の質問など）は動的に追加できるUI
- **重複チェック**: 同一サービス・同一ユーザーでの重複登録防止

#### F-CRUD-02: 情報の参照
- 登録されているすべてのパスワード情報を一覧表示する
- パスワードなどの機密情報は通常隠蔽し、クリック/タップで表示・コピー可能
- **一括表示機能**: 必要時に複数の機密情報を同時表示可能
- **印刷機能**: 緊急時用の印刷可能な形式での出力

#### F-CRUD-03: 情報の更新
- 既存のパスワード情報を編集・更新できる
- 更新時は変更理由の入力を必須とする
- **一括更新機能**: 同じパスワードを使い回している場合の一括変更

#### F-CRUD-04: 情報の削除
- 不要になったパスワード情報を削除できる
- 削除前に確認ダイアログを表示し、誤削除を防止する
- **論理削除**: 完全削除ではなく、一定期間は復旧可能な仕組み

### 4.4 検索・絞り込み・ソート

#### F-Search-01: 検索機能
- サービス名、ID、メモなどでのフリーワード検索
- **あいまい検索**: 部分一致、ひらがな・カタカナ・漢字の相互変換対応
- **タグ検索**: ハッシュタグ形式でのメモ検索

#### F-Search-02: 家族メンバーフィルター
- 登録者による絞り込み（父、母、息子、娘、共通）
- **アクセス権限**: 個人専用設定で他メンバーからの閲覧を制限可能

#### F-Search-03: カテゴリフィルター
- 事前定義されたカテゴリでの絞り込み
- **カスタムカテゴリ**: ユーザー定義のカテゴリ追加機能

#### F-Search-04: ソート・並び替え
- サービス名、最終更新日時、重要度、有効期限での並び替え
- **お気に入り機能**: よく使用するパスワード情報の優先表示

### 4.5 履歴管理

#### F-History-01: 変更履歴記録
- パスワード情報の作成・更新・削除のすべての操作を記録
- 記録項目: 変更前後のデータ、変更日時、変更者、変更理由
- **差分表示**: 変更前後の差分をわかりやすく表示

#### F-History-02: 履歴参照・復元
- 各エントリの変更履歴を時系列で表示
- 過去のバージョンへのロールバック機能
- **履歴検索**: 特定の期間や変更者での履歴絞り込み

### 4.6 家族向け特殊機能

#### F-Family-01: 共有機能
- 家族共通のパスワード情報（WiFi、共有サービスなど）の管理
- **緊急アクセス**: 緊急時に管理者権限でのアクセス機能

#### F-Family-02: 通知機能
- パスワード有効期限の事前通知
- 新規登録・更新時の家族への通知（オプション）

## 5. 非機能要件

### 5.1 セキュリティ

#### NF-SEC-01: 通信セキュリティ
- すべての通信はHTTPS (TLS 1.3以上) で行う
- HSTS (HTTP Strict Transport Security) を有効化

#### NF-SEC-02: データ暗号化
- 機密データはAES-256-GCMで暗号化
- パスワードハッシュ化にはbcryptまたはArgon2を使用
- **キー管理**: 暗号化キーの定期的なローテーション

#### NF-SEC-03: 攻撃対策
- ブルートフォースアタック対策（レート制限、アカウントロック）
- XSS、CSRF、SQLインジェクション対策
- **セキュリティヘッダー**: 適切なセキュリティヘッダーの設定

#### NF-SEC-04: 証明書管理
- クライアント証明書の定期的な更新（年1回）
- 証明書失効時の迅速な対応（CRL/OCSP）
- **デバイス管理**: 紛失・盗難時の証明書無効化手順

### 5.2 ユーザビリティ

#### NF-US-01: インターフェース
- 直感的で分かりやすいUI/UX設計
- **アクセシビリティ**: WCAG 2.1 AA準拠
- 日本語フォントの最適化

#### NF-US-02: レスポンシブデザイン
- iPhone、Android、タブレット、PCでの最適表示
- **タッチ操作**: タッチデバイスでの操作性向上
- **ダークモード**: ダークモード対応

#### NF-US-03: パフォーマンス
- 初回読み込み時間: 3秒以内
- ページ遷移: 1秒以内
- **オフライン対応**: PWA化によるオフライン閲覧機能

### 5.3 信頼性・可用性

#### NF-REL-01: データ永続性
- データの冗長化とバックアップ（日次自動バックアップ）
- **災害対策**: 地理的分散バックアップ

#### NF-REL-02: 可用性
- 稼働率 99.9% 以上を目標
- **フェイルオーバー**: サービス停止時の自動復旧

#### NF-REL-03: データ整合性
- トランザクション処理による整合性保証
- **バージョン管理**: 同時更新時の競合解決

### 5.4 運用・保守

#### NF-MNT-01: 開発・デプロイ
- GitHub での完全なソースコード管理
- CI/CD パイプラインでの自動テスト・デプロイ
- **環境管理**: 開発・ステージング・本番環境の分離

#### NF-MNT-02: 監視・ログ
- アプリケーションログとアクセスログの記録
- **監視**: エラー監視とパフォーマンス監視
- **アラート**: 異常検知時の自動通知

#### NF-MNT-03: 保守性
- コードの可読性とドキュメント整備
- **テスト**: 単体テスト・結合テストの自動実行
- **更新**: セキュリティアップデートの定期適用

## 6. 制約事項

### 6.1 技術制約
- iPhone のクライアント証明書機能に依存
- 各種ホスティングサービスの利用規約に準拠
- 無料枠・低コストでの運用を前提

### 6.2 運用制約  
- 家族内での運用のため、24時間サポートは不要
- データ移行・バックアップは手動運用も許容
- 法的な監査要件は対象外

## 7. 成功基準

### 7.1 機能面
- 全家族メンバーが迷いなく操作できること
- パスワード情報の登録・検索が30秒以内で完了すること
- データ消失・漏洩事故ゼロ

### 7.2 運用面
- 月次の運用コストが1,000円以下
- システム停止時間が月1時間以内
- 家族の満足度調査で80%以上の満足度

---

**文書バージョン**: 1.0  
**作成日**: 2024年  
**最終更新**: 2024年  
**承認者**: 家族会議にて承認予定